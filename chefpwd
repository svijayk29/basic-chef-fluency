
centos7 chef server lab installation
chef-server-ctl reconfigure
chef-server-ctl user-create  vijay  vijay roark vijay.roark@gmail.com 'Ramana29@' --filename vijay-user-rsa
username vijay
fullname vijay roark
email vijay.roark@gmail.com
password 'Ramana29@'
 --filename vijay-user-rsa

 chef-server-ctl org-create roarkent 'roark enterprises' --association_user vijay --filenam roarkent-validator-pem


organization name roarkent
fullname'roark enterprises'
 --association_user vijay
 --filename roarkent-validator.pem

chef-server-ctl install chef-manage
chef-manage-ctl reconfigure
knife ssl check - successful
bootstrapping a node(needs internet connection)
knife bootstrap 192.168.1.212  -N webserver --ssh-user vijay --sudo
"chefpwd"

create github account
username svijayk29
vijay.roark@gmail.com
ramana29
created a new repository basic-chef-fluency
now back at workstation
git init
git add .
git commit -am "first commit" (a for all and m is for message)
git config --global user-email "vijay.roark@gmail.com" (just once)
git config --global user-name " vijay"  (just once)

git remote add origin https://github.com/svijayk29/basic-chef-fluency.git (just once)

git push -u origin master

creating a new cookbook and uploading to github

knife cookbook create learn
git add .
git commit -am "adding cookbook learn" (a for all and m is for message)
git push -u origin master

creating a new cookbook called apache and uploading to webserver node

chef generate cookbook cookbooks/apache
amend default.rb file to install, start and enable apache2
create new recipe call websites.rb to create a personalized index page

upload the cookbook

knife cookbook upload apache

add to git hub by the above commands

knife node list command shows nodes running

to add a run list to a node

knife node run_list add webserver 'recipe[apache]'

to show various attributes of node
knife node show webserver

knife node show -l webserver(all)

dry run command


 chef-client --why-run

then to implement default.rb
chef-client

make changes to default.rb to include websites file and upload
knife cookbook upload apache
chef-client   (to see the custom index file)

next remove include_file command from default.rb file and put in a seperate run list

knife node run_list add webserver 'recipe[apache::websites]'

next i tried removing the index file with action :delete and then uploaded the cookbook to node

knife cookbook upload apache

knife node run_list add webserver 'recipe[apache::websites]' -b 'recipe[apache]

knife node run_list add webserver 'recipe[apache::websites]' -a 'recipe[apache]

knife node run_list remove  webserver 'recipe[apache::websites], recipe[apache]'

edited default.rb file to include an if condition for centos and apache by using node attribute(platform)

created a new file motd.rb with a file attribute to display a message using node attriute(hostname) and using a variable to hold the hostname

changed metadata file to version 0.2.1

uploaded to git

knife cookbook upload apache

knife node run_list add webserver 'recipe[motd]'

then run chef-client on node webserver as root)otherwise fails because cant find key)

Missing Cookbooks:
------------------
The following cookbooks are required by the client but don't exist on the server:
* motd

go back to work station and 
$knife node run_list remove webserver 'recipe[motd]'
and
$knife node run_list add webserver 'recipe[apache::motd]'

result is

webserver:
  run_list:
    recipe[apache]
    recipe[apache::websites]
    recipe[apache::motd]

now go back to node webserver and run

chef-client 

if condition didnt work properly even thoough apache2 installed started and index page changed. But chef was also looking for httpd service to start(this is based on my own addition to recipe. i need to  fix it. didnt create motd file either.

fixed all errors by creating two if conditions. worked on ubu and now going to bootstrap centos and test
bootstrap succeeded but chef-client failed to run runlists correctly
The problem was with the code for httpd package installation code. Cleaned it up and worked perfectly on centos too.
